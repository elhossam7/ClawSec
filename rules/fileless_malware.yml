id: fileless_malware
title: Fileless Malware Execution Detection
description: >
  Detects fileless malware techniques that execute code entirely in memory without
  writing to disk. Monitors for PowerShell download cradles, reflective DLL loading,
  .NET assembly loading in memory, and AMSI bypass attempts.
severity: critical
status: active
author: sentinel-ai
tags:
    - attack.execution
    - attack.defense_evasion
    - attack.t1059.001
    - attack.t1620
    - fileless
    - memory_execution
logsource:
    category: process_creation
    product: windows
    service: ""
detection:
    selection_download_cradle:
        raw|contains:
            - "IEX(New-Object Net.WebClient)"
            - "Invoke-Expression(New-Object"
            - "IEX (iwr"
            - "IEX(iwr"
            - "DownloadString("
            - "DownloadData("
            - "Net.WebClient).DownloadFile"
    selection_reflection:
        raw|contains:
            - "[System.Reflection.Assembly]::Load"
            - "Reflection.Assembly]::LoadWithPartialName"
            - "[System.Reflection.Assembly]::LoadFile"
            - "Assembly.Load("
            - "Unsafe.AsPointer"
    selection_amsi_bypass:
        raw|contains:
            - "AmsiUtils"
            - "amsiInitFailed"
            - "AmsiScanBuffer"
            - "AmsiContext"
            - "Set-MpPreference -DisableRealtimeMonitoring"
    selection_encoded_exec:
        raw|re: "(?i)powershell.*(\\-enc|\\-encodedcommand|\\-e )\\s+[A-Za-z0-9+/=]{40,}"
    selection_memory_injection:
        raw|contains:
            - "[Runtime.InteropServices.Marshal]::"
            - "GetDelegateForFunctionPointer"
            - "VirtualAlloc"
            - "FromBase64String"
    condition: selection_download_cradle or selection_reflection or selection_amsi_bypass or selection_encoded_exec or selection_memory_injection
response:
    - type: kill_process
      target_field: pid
    - type: alert
      target_field: username
